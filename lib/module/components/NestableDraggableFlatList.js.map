{"version":3,"names":["React","useRef","useState","findNodeHandle","useDerivedValue","useSharedValue","DraggableFlatList","useSafeNestableScrollContainerContext","useNestedAutoScroll","useStableCallback","NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","__DEV__","ignoreWarns","errorWarn","global","console","error","arg","startsWith","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","value","autoscrollThreshold","onListContainerLayout","containerRef","nodeHandle","current","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlashList } from \"@shopify/flash-list\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlashList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (__DEV__) {\n    const ignoreWarns = [\n      \"VirtualizedLists should never be nested inside plain ScrollViews\",\n    ];\n\n    const errorWarn = global.console.error;\n    global.console.error = (...arg) => {\n      for (const error of ignoreWarns) {\n        if (arg[0].startsWith(error)) {\n          return;\n        }\n      }\n      errorWarn(...arg);\n    };\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n    autoscrollThreshold: props.autoscrollThreshold,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlashList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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"}