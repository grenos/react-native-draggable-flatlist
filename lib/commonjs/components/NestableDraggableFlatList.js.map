{"version":3,"names":["NestableDraggableFlatListInner","props","ref","hasSuppressedWarnings","useRef","__DEV__","ignoreWarns","errorWarn","global","console","error","arg","startsWith","useSafeNestableScrollContainerContext","scrollableRef","outerScrollOffset","setOuterScrollEnabled","listVerticalOffset","useSharedValue","useState","animVals","setAnimVals","defaultHoverOffset","listHoverOffset","setListHoverOffset","hoverOffset","useDerivedValue","value","useNestedAutoScroll","autoscrollThreshold","onListContainerLayout","useStableCallback","containerRef","nodeHandle","findNodeHandle","current","onSuccess","_x","y","onFail","log","measureLayout","onDragBegin","params","onDragEnd","onAnimValInit","activationDistance","NestableDraggableFlatList","React","forwardRef"],"sources":["NestableDraggableFlatList.tsx"],"sourcesContent":["import React, { useRef, useState } from \"react\";\nimport { findNodeHandle, LogBox } from \"react-native\";\nimport Animated, {\n  useDerivedValue,\n  useSharedValue,\n} from \"react-native-reanimated\";\nimport { DraggableFlatListProps } from \"../types\";\nimport DraggableFlatList from \"../components/DraggableFlatList\";\nimport { useSafeNestableScrollContainerContext } from \"../context/nestableScrollContainerContext\";\nimport { useNestedAutoScroll } from \"../hooks/useNestedAutoScroll\";\nimport { typedMemo } from \"../utils\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport { FlashList } from \"@shopify/flash-list\";\n\nfunction NestableDraggableFlatListInner<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlashList<T>>\n) {\n  const hasSuppressedWarnings = useRef(false);\n\n  if (__DEV__) {\n    const ignoreWarns = [\n      \"VirtualizedLists should never be nested inside plain ScrollViews\",\n    ];\n\n    const errorWarn = global.console.error;\n    global.console.error = (...arg) => {\n      for (const error of ignoreWarns) {\n        if (arg[0].startsWith(error)) {\n          return;\n        }\n      }\n      errorWarn(...arg);\n    };\n  }\n\n  const {\n    scrollableRef,\n    outerScrollOffset,\n    setOuterScrollEnabled,\n  } = useSafeNestableScrollContainerContext();\n\n  const listVerticalOffset = useSharedValue(0);\n  const [animVals, setAnimVals] = useState({});\n  const defaultHoverOffset = useSharedValue(0);\n  const [listHoverOffset, setListHoverOffset] = useState(defaultHoverOffset);\n\n  const hoverOffset = useDerivedValue(() => {\n    return listHoverOffset.value + listVerticalOffset.value;\n  }, [listHoverOffset]);\n\n  useNestedAutoScroll({\n    ...animVals,\n    hoverOffset,\n    autoscrollThreshold: props.autoscrollThreshold,\n  });\n\n  const onListContainerLayout = useStableCallback(async ({ containerRef }) => {\n    const nodeHandle = findNodeHandle(scrollableRef.current);\n\n    const onSuccess = (_x: number, y: number) => {\n      listVerticalOffset.value = y;\n    };\n    const onFail = () => {\n      console.log(\"## nested draggable list measure fail\");\n    };\n    //@ts-ignore\n    containerRef.current.measureLayout(nodeHandle, onSuccess, onFail);\n  });\n\n  const onDragBegin: DraggableFlatListProps<T>[\"onDragBegin\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(false);\n      props.onDragBegin?.(params);\n    }\n  );\n\n  const onDragEnd: DraggableFlatListProps<T>[\"onDragEnd\"] = useStableCallback(\n    (params) => {\n      setOuterScrollEnabled(true);\n      props.onDragEnd?.(params);\n    }\n  );\n\n  const onAnimValInit: DraggableFlatListProps<T>[\"onAnimValInit\"] = useStableCallback(\n    (params) => {\n      setListHoverOffset(params.hoverOffset);\n      setAnimVals({\n        ...params,\n        hoverOffset,\n      });\n      props.onAnimValInit?.(params);\n    }\n  );\n\n  return (\n    <DraggableFlatList\n      ref={ref}\n      onContainerLayout={onListContainerLayout}\n      activationDistance={props.activationDistance || 20}\n      scrollEnabled={false}\n      {...props}\n      outerScrollOffset={outerScrollOffset}\n      onDragBegin={onDragBegin}\n      onDragEnd={onDragEnd}\n      onAnimValInit={onAnimValInit}\n    />\n  );\n}\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport const NestableDraggableFlatList = React.forwardRef(\n  NestableDraggableFlatListInner\n) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlashList<T>> }\n) => ReturnType<typeof NestableDraggableFlatListInner>;\n"],"mappings":"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"}